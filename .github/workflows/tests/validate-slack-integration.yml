# ğŸ§ª Validation Workflows
# This folder contains validation workflows that test gem-ci setup and functionality
# These are separate from production workflows (01-08) that get copied by the CLI tool

name: "Validate Slack Integration"
on:
  workflow_dispatch:

jobs:
  validate-slack:
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ”‘ Generate GitHub App Token"
        id: app_token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.GEM_CI_APP_ID }}
          private-key: ${{ secrets.GEM_CI_PRIVATE_KEY }}
      
      - name: "ğŸ“¢ Test Basic Slack Notification"
        uses: slackapi/slack-github-action@v1.27.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          slack-message: |
            ğŸ§ª **gem-ci Slack Integration Test**
            
            âœ… Basic notification working
            ğŸ¤– Sent via: gem-ci[bot]
            â° Time: ${{ github.event.head_commit.timestamp }}
            ğŸ”— Workflow: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      
      - name: "ğŸ“Š Test Rich Slack Notification with Blocks"
        uses: slackapi/slack-github-action@v1.27.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          payload: |
            {
              "text": "ğŸ§ª gem-ci Slack Integration - Rich Message Test",
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "ğŸ¤– gem-ci Slack Integration Test"
                  }
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "âœ… *Rich notification test successful!*\n\nğŸ“‹ *Test Results:*\nâ€¢ ğŸ”‘ GitHub App token: Working\nâ€¢ ğŸ“¢ Basic message: âœ… Delivered\nâ€¢ ğŸ¨ Rich blocks: âœ… Rendered\nâ€¢ ğŸ¤– Branded bot: âœ… Active"
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "*Repository:*\n${{ github.repository }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Workflow:*\nSlack Integration Test"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Triggered by:*\n${{ github.actor }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Status:*\nâœ… Success"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "View Workflow Run"
                      },
                      "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                    }
                  ]
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "mrkdwn",
                      "text": "ğŸš€ Ready for production workflows â€¢ ğŸ”§ gem-ci automation"
                    }
                  ]
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      
      - name: "ğŸ§ª Test Conditional Slack Notification (Success)"
        if: success()
        uses: slackapi/slack-github-action@v1.27.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          slack-message: |
            âœ… **Conditional Success Notification Test**
            
            This message only appears when all previous steps succeed.
            Perfect for production workflow success notifications!
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      
      - name: "ğŸ§ª Test Conditional Slack Notification (Always)"
        if: always()
        uses: slackapi/slack-github-action@v1.27.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          slack-message: |
            ğŸ“Š **Final Status Notification**
            
            Status: ${{ job.status == 'success' && 'âœ… SUCCESS' || 'âŒ FAILED' }}
            
            This message always appears regardless of workflow outcome.
            Perfect for monitoring critical production workflows!
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      
      - name: "âœ… Slack Integration Validation Complete"
        run: |
          echo "ğŸ‰ Slack integration validation completed!"
          echo "ğŸ“‹ Summary:"
          echo "  ğŸ“¢ Basic notifications: Working"
          echo "  ğŸ¨ Rich block messages: Working"
          echo "  ğŸ”„ Conditional messages: Working"
          echo "  ğŸ¤– Branded bot identity: Active"
          echo ""
          echo "ğŸ’¡ Ready for production workflows:"
          echo "  â€¢ Release notifications (06-release.yml)"
          echo "  â€¢ Security alerts (03-security.yml)"
          echo "  â€¢ CI failures (02-ci.yml)"
          echo "  â€¢ Community milestones (05-community.yml)" 